
# 鸿蒙应用开发实验报告：商务差旅报销系统

**项目名称**：商务差旅报销系统
**开发语言**：ArkTS (HarmonyOS)
**开发工具**：DevEco Studio

## 一、 项目简介

本项目实现了一个基于 HarmonyOS 的商务差旅报销应用程序。主要用于模拟企业员工提交差旅费用的流程。系统包含表单填写、费用明细动态管理、总额自动计算、预览确认以及历史记录归档功能。项目旨在演示 ArkUI 的组件化开发、页面间数据传递及本地数据持久化技术。

## 二、 工程目录结构说明

根据项目 `ets` 目录结构，各模块功能说明如下：

### 1. components (自定义组件层)
*   **ActionButtons.ets**: 封装页面底部的操作栏，包含“预览报销单”等按钮及其点击回调逻辑。
*   **BaseInfo.ets**: 基本信息填写模块，负责收集出差人、部门、事由、起止日期及城市等信息。
*   **Calculator.ets**: 自定义数字键盘计算器组件，用于在填写金额时提供便捷的计算输入功能。
*   **ExpenseItem.ets**: 费用明细列表容器组件，负责渲染整个列表，监听数组变化并计算总金额。
*   **ExpenseItemCard.ets**: 单个费用项卡片组件，包含费用类型选择、金额输入、备注填写及删除该项的功能。
*   **FormField.ets**: 通用表单输入组件，封装了 `TextInput`，统一了标签样式，并处理了输入框的双向绑定逻辑。

### 2. models (数据模型层)
*   **FormData.ets**: 定义核心数据结构。
    *   `FormData` 类：封装基本信息字段。
    *   `ExpenseItem` 类：封装单笔费用明细，包含生成唯一 ID 及金额数值转换方法。
    *   `HistoryRecord` 接口：定义历史提交记录的数据结构（包含时间戳、摘要、原始数据快照）。

### 3. pages (视图控制层)
*   **Index.ets (主页)**: 应用入口页面。
    *   负责组装各子组件（BaseInfo, ExpenseItemSection）。
    *   实现历史记录弹窗 (`CustomDialog`)。
    *   处理页面生命周期 (`onPageShow`) 以实现提交后的自动表单清空。
*   **Preview.ets (预览页)**:
    *   展示汇总后的报销单信息。
    *   执行数据提交逻辑，将数据序列化后保存至本地存储 (`PersistentStorage`)。

## 三、 功能实现

1.  **基本信息录入**：支持文本输入及日期选择，解决了 ArkUI 中文输入法兼容性问题。
2.  **费用明细管理**：
    *   支持动态添加、删除费用项。
    *   支持下拉选择费用类型（交通、住宿、餐饮等）。
    *   实时自动计算所有费用项的总金额。
3.  **页面跳转与传参**：从主页跳转至预览页时，传递复杂的对象数组数据。
4.  **数据持久化与历史记录**：
    *   提交后将报销单保存至应用本地存储。
    *   在主页可弹窗查看所有历史提交记录。
    *   提交成功后自动重置主页表单状态。

## 四、 关键技术点

1.  **对象数组的深度监听**：
    *   使用 `@Observed` 装饰 `ExpenseItem` 类，配合子组件中的 `@ObjectLink`，实现了修改数组内对象属性（如金额、类型）时，UI 能够实时刷新。
2.  **解决输入法冲突**：
    *   在 `FormField` 组件中采用 `$$` 双向绑定语法，解决了 `TextInput` 组件在数据回流时打断中文拼音输入的问题。
3.  **复杂对象传递与还原**：
    *   利用 `JSON.stringify` 在路由跳转时传递数据。
    *   在接收端通过构造函数（`new Class(json)`）重新实例化对象，防止类方法（如 `getAmountNumber`）在传输过程中丢失。
4.  **全局状态通信**：
    *   使用 `AppStorage` 设置全局标记 (`shouldClearForm`)，实现了跨页面的状态控制（从预览页控制主页清空）。

## 五、 运行环境

*   **IDE**: DevEco Studio 3.1+
*   **SDK**: HarmonyOS API 9 / API 11+
